<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Saúde Bucal - material suplementar</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="br_script_sb_files/libs/clipboard/clipboard.min.js"></script>
<script src="br_script_sb_files/libs/quarto-html/quarto.js"></script>
<script src="br_script_sb_files/libs/quarto-html/popper.min.js"></script>
<script src="br_script_sb_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="br_script_sb_files/libs/quarto-html/anchor.min.js"></script>
<link href="br_script_sb_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="br_script_sb_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="br_script_sb_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="br_script_sb_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="br_script_sb_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#procedimentos-metodológicos" id="toc-procedimentos-metodológicos" class="nav-link active" data-scroll-target="#procedimentos-metodológicos">Procedimentos metodológicos</a></li>
  <li><a href="#preparando-ambiente-do-r" id="toc-preparando-ambiente-do-r" class="nav-link" data-scroll-target="#preparando-ambiente-do-r">Preparando ambiente do R</a></li>
  <li><a href="#a-aplicação-reduzida-para-um-município" id="toc-a-aplicação-reduzida-para-um-município" class="nav-link" data-scroll-target="#a-aplicação-reduzida-para-um-município">A) Aplicação reduzida para um município</a>
  <ul class="collapse">
  <li><a href="#definição-de-escopo" id="toc-definição-de-escopo" class="nav-link" data-scroll-target="#definição-de-escopo">1. Definição de escopo</a></li>
  <li><a href="#análise-das-necessidades-de-saúde-bucal" id="toc-análise-das-necessidades-de-saúde-bucal" class="nav-link" data-scroll-target="#análise-das-necessidades-de-saúde-bucal">2. Análise das necessidades de saúde bucal</a>
  <ul class="collapse">
  <li><a href="#levantando-a-faixa-etária-p" id="toc-levantando-a-faixa-etária-p" class="nav-link" data-scroll-target="#levantando-a-faixa-etária-p">2.1. Levantando a faixa etária (P)</a></li>
  <li><a href="#cobertura-de-condições-de-saúde-bucal-h" id="toc-cobertura-de-condições-de-saúde-bucal-h" class="nav-link" data-scroll-target="#cobertura-de-condições-de-saúde-bucal-h">2.2. Cobertura de condições de saúde bucal (H)</a></li>
  <li><a href="#parâmetros-normativos-de-procedimentos-per-capita-s" id="toc-parâmetros-normativos-de-procedimentos-per-capita-s" class="nav-link" data-scroll-target="#parâmetros-normativos-de-procedimentos-per-capita-s">2.3. Parâmetros normativos de procedimentos per capita (S)</a></li>
  </ul></li>
  <li><a href="#tradução-do-número-de-serviços-em-número-de-profissionais-necessários" id="toc-tradução-do-número-de-serviços-em-número-de-profissionais-necessários" class="nav-link" data-scroll-target="#tradução-do-número-de-serviços-em-número-de-profissionais-necessários">3. Tradução do número de serviços em número de profissionais necessários</a></li>
  <li><a href="#exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos" id="toc-exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos" class="nav-link" data-scroll-target="#exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos">4. Exploração das implicações em termos de recursos, como a oferta atual de profissionais e custos</a>
  <ul class="collapse">
  <li><a href="#obtenção-da-oferta-de-profissionais" id="toc-obtenção-da-oferta-de-profissionais" class="nav-link" data-scroll-target="#obtenção-da-oferta-de-profissionais">4.1. Obtenção da oferta de profissionais</a></li>
  <li><a href="#cálculo-de-valor-líquido-da-oferta" id="toc-cálculo-de-valor-líquido-da-oferta" class="nav-link" data-scroll-target="#cálculo-de-valor-líquido-da-oferta">4.2. Cálculo de valor líquido da oferta</a></li>
  <li><a href="#implicações-de-resultados-em-termos-quantitativos" id="toc-implicações-de-resultados-em-termos-quantitativos" class="nav-link" data-scroll-target="#implicações-de-resultados-em-termos-quantitativos">4.3. Implicações de resultados em termos quantitativos</a></li>
  <li><a href="#implicações-de-resultados-em-termos-financeiros" id="toc-implicações-de-resultados-em-termos-financeiros" class="nav-link" data-scroll-target="#implicações-de-resultados-em-termos-financeiros">4.4. Implicações de resultados em termos financeiros</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#b-aplicação-para-brasil" id="toc-b-aplicação-para-brasil" class="nav-link" data-scroll-target="#b-aplicação-para-brasil">B) Aplicação para Brasil</a>
  <ul class="collapse">
  <li><a href="#análise-das-necessidades-de-saúde-bucal-para-o-brasil" id="toc-análise-das-necessidades-de-saúde-bucal-para-o-brasil" class="nav-link" data-scroll-target="#análise-das-necessidades-de-saúde-bucal-para-o-brasil">5. Análise das necessidades de saúde bucal para o Brasil</a>
  <ul class="collapse">
  <li><a href="#levantando-a-faixa-etária-p---brasil" id="toc-levantando-a-faixa-etária-p---brasil" class="nav-link" data-scroll-target="#levantando-a-faixa-etária-p---brasil">5.1. Levantando a faixa etária (P) - Brasil</a></li>
  <li><a href="#prevalência-de-condições-de-saúde-bucal-h---brasil" id="toc-prevalência-de-condições-de-saúde-bucal-h---brasil" class="nav-link" data-scroll-target="#prevalência-de-condições-de-saúde-bucal-h---brasil">5.2. Prevalência de condições de saúde bucal (H) - Brasil</a></li>
  <li><a href="#parâmetros-normativos-de-procedimentos-per-capita-s---brasil" id="toc-parâmetros-normativos-de-procedimentos-per-capita-s---brasil" class="nav-link" data-scroll-target="#parâmetros-normativos-de-procedimentos-per-capita-s---brasil">5.3. Parâmetros normativos de procedimentos per capita (S) - BRASIL</a></li>
  </ul></li>
  <li><a href="#tradução-do-número-de-serviços-em-número-de-profissionais-necessários---brasil" id="toc-tradução-do-número-de-serviços-em-número-de-profissionais-necessários---brasil" class="nav-link" data-scroll-target="#tradução-do-número-de-serviços-em-número-de-profissionais-necessários---brasil">6. Tradução do número de serviços em número de profissionais necessários - BRASIL</a></li>
  <li><a href="#exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos-1" id="toc-exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos-1" class="nav-link" data-scroll-target="#exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos-1">7. Exploração das implicações em termos de recursos, como a oferta atual de profissionais e custos</a>
  <ul class="collapse">
  <li><a href="#obtenção-da-oferta-de-profissionais-1" id="toc-obtenção-da-oferta-de-profissionais-1" class="nav-link" data-scroll-target="#obtenção-da-oferta-de-profissionais-1">7.1. Obtenção da oferta de profissionais</a></li>
  <li><a href="#cálculo-de-valor-líquido-da-oferta-1" id="toc-cálculo-de-valor-líquido-da-oferta-1" class="nav-link" data-scroll-target="#cálculo-de-valor-líquido-da-oferta-1">7.2. Cálculo de valor líquido da oferta</a></li>
  <li><a href="#implicações-de-resultados" id="toc-implicações-de-resultados" class="nav-link" data-scroll-target="#implicações-de-resultados">7.3. Implicações de resultados</a></li>
  </ul></li>
  <li><a href="#análise-de-cenário" id="toc-análise-de-cenário" class="nav-link" data-scroll-target="#análise-de-cenário">8. Análise de Cenário</a></li>
  </ul></li>
  <li><a href="#referências" id="toc-referências" class="nav-link" data-scroll-target="#referências">Referências</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Saúde Bucal - material suplementar</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="procedimentos-metodológicos" class="level2">
<h2 class="anchored" data-anchor-id="procedimentos-metodológicos">Procedimentos metodológicos</h2>
<p>A construção do modelo de planejamento da força de trabalho (PDFT) para saúde bucal baseado em necessidades foi elaborado a partir das orientações de Asamani et al.&nbsp;(2021) que sugerem algumas etapas, que serão descritas com maior detalhamento a seguir:</p>
<ol type="1">
<li>Definição de escopo da metodologia em termos de cobertura jurisdicional, objetivos e horizonte temporal;</li>
<li>Análise da necessidade de saúde bucal com base em aspectos da demografia, epidemiologia e serviços destinados da população a local;</li>
<li>Tradução do número de serviços em número de profissionais necessários;</li>
<li>Exploração das implicações em termos de recursos, como a oferta atual de profissionais e custos;</li>
<li>Análise de sensibilidade para simulação de parâmetros de incerteza;</li>
<li>Validação de modelo por meio de consulta a stakeholders.</li>
</ol>
</section>
<section id="preparando-ambiente-do-r" class="level2">
<h2 class="anchored" data-anchor-id="preparando-ambiente-do-r">Preparando ambiente do R</h2>
<p>Carregando os pacotes necessários para o R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RODBC)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geobr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel) </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial) </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geojsonio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Este documento possui duas seções: A e B. A primeira é uma plicação reduzida para apenas um município, Palmas-TO. Na seção B, nós ampliamos a aplicação para todo os 5570 municípios no território nacional.</p>
</section>
<section id="a-aplicação-reduzida-para-um-município" class="level1">
<h1>A) Aplicação reduzida para um município</h1>
<section id="definição-de-escopo" class="level2">
<h2 class="anchored" data-anchor-id="definição-de-escopo">1. Definição de escopo</h2>
<p>A metodologia tem como objetivo estimar a força de trabalho atual e necessária de cirurgiões dentistas e técnicos e auxilares de saúde bucal para atuação em municípios brasileiros, a nível de atenção primária, em procedimentos de natureza individual, bem como três procedimentos de natureza especializada: endodontia, prótese e periodontia. Para esta aplicação, usamos apenas Palmas-TO como referência.</p>
</section>
<section id="análise-das-necessidades-de-saúde-bucal" class="level2">
<h2 class="anchored" data-anchor-id="análise-das-necessidades-de-saúde-bucal">2. Análise das necessidades de saúde bucal</h2>
<p>A análise da necessidade de saúde bucal (NSB) foi construída a partir de três elementos: distribuição da população por faixa etária (P), prevalência de condições de saúde bucal (H) e procedimentos per capita (S).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/equacao1_sb.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Onde:</p>
<ul>
<li>NSB = Necessidade de saúde bucal é o número de serviços do tipo t destinados ao atendimento de população de faixa etária i e localidade l;</li>
<li>P = População por faixa-etária i de uma localidade l;</li>
<li>H = Prevalência de condições de saúde bucal que levam à necessidade de procedimentos do tipo t por faixa-etária i e dentro de uma localidade l;</li>
<li>S = Procedimentos per capita do tipo t, para cada faixa-etária i e dentro de uma localidade l.</li>
</ul>
<section id="levantando-a-faixa-etária-p" class="level3">
<h3 class="anchored" data-anchor-id="levantando-a-faixa-etária-p">2.1. Levantando a faixa etária (P)</h3>
<p>A distribuição por faixa etária foi construída com base em dados do último censo (2022) e estão disponíveis na página do IBGE. Para fins de exemplificação, vamos trabalhar apenas com o município de referência: Palmas (TO).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># leitura dos dados de populacao</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>pop_tocantins <span class="ot">&lt;-</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/pop_tocantins.xlsx"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filtrando dados de palmas, empilhando variavel de faixa etaria e criando uma id que representa cada faixa etaria</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>pop_palmas <span class="ot">&lt;-</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>              pop_tocantins <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">filter</span>(ibge <span class="sc">==</span> <span class="st">"1721000"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">select</span>(ibge, Município, de_0_a_14_anos,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                         de_15_a_29_anos, de_30_a_59_anos,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                         acima_de_60_anos) <span class="sc">|&gt;</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"faixa"</span>, </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> <span class="st">"total"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">3</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">faixa =</span> <span class="fu">gsub</span>(<span class="st">"_"</span>,<span class="st">" "</span>,faixa)) <span class="sc">|&gt;</span> </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">as.character</span>(ibge)) <span class="sc">|&gt;</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge, <span class="dv">1</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">id_faixa =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 0 a 14 anos"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 15 a 29 anos"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 30 a 59 anos"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"acima de 60 anos"</span> <span class="sc">~</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notamos que a faixa etária de 30 a 59 anos possui maior frequência em relação às demais, conforme gráfico abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ordem <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"de 0 a 14 anos"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"de 15 a 29 anos"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"de 30 a 59 anos"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"acima de 60 anos"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pop_palmas<span class="sc">$</span>faixa <span class="ot">&lt;-</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(pop_palmas<span class="sc">$</span>faixa, <span class="at">levels =</span> ordem)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>pop_palmas <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> faixa, <span class="at">y =</span> total)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribuição de faixa etária por município"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>O censo possui outras divisões de faixa etárias. Utilizamos estas para padronizar com os dados do próximo parâmetro (H), calculado a partir da pesquisa de SB 2010 (subseção seguinte).</p>
</section>
<section id="cobertura-de-condições-de-saúde-bucal-h" class="level3">
<h3 class="anchored" data-anchor-id="cobertura-de-condições-de-saúde-bucal-h">2.2. Cobertura de condições de saúde bucal (H)</h3>
<p>O Ministério da Saúde traz uma série de parâmetros para planejamento dos serviços de saúde bucal (Brasil, 2021). Um dos parâmetros é a <strong>cobertura de serviços de saúde</strong>. A cobertura foi calculada a partir da pesquisa SB 2010 para cada faixa etária e tipo de procedimento conforme a lógica expressa abaixo.</p>
<p>Cabe destacar que, devido à estrutura da SB2010, estes parâmetros foram calculados para capitais de cada estado ou interior da região.</p>
<table class="caption-top table">
<caption>Fonte: Brasil (2021)</caption>
<colgroup>
<col style="width: 4%">
<col style="width: 95%">
</colgroup>
<thead>
<tr class="header">
<th>Área</th>
<th>Expressões usadas para cálculo de cobertura</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Atenção básica</td>
<td>NT_1 (Número de dentes necessitando de restauração de 1 superfície) + NT_2 (Número de dentes necessitando de restauração de 2 ou mais superfícies) + NT_6 (Número de dentes necessitando de extração) + NT_7 (Número de dentes necessitando de controle de lesão branca) + NT_8 (Número de dentes necessitando de selante) + P_CALC (Prevalência de cálculo) + P_BR (Prevalência de bolsa rasa). Foi então criada a variável COB_AB. Se COB_AB = 0 o indivíduo não necessita de procedimentos de atenção básica, se COB_AB =1 ele necessita. A cobertura de atenção básica foi então estimada pelo percentual de pessoas com COB_AB=1</td>
</tr>
<tr class="even">
<td>Endodontia</td>
<td>A cobertura de endodontia foi calculada a partir da variável NT_5 (Número de dentes necessitando de tratamento pulpar + restauração). Foi criada a variável ENDO onde ENDO=0 se NT_5=0 e ENDO=1 se NT_5≠0. Desta forma, a cobertura de endodontia foi então estimada pelo percentual de pessoas com ENDO=1</td>
</tr>
<tr class="odd">
<td>Periodontia especializada</td>
<td>A cobertura de periodontia especializada foi estimada pelo percentual de pessoas com a variável P_BP (Prevalência de bolsa profunda) = 1</td>
</tr>
<tr class="even">
<td>Prótese</td>
<td>A cobertura de prótese foi calculada pelo percentual de pessoas com a variável NECPROT (Necessidade geral de prótese) ≠ 0</td>
</tr>
</tbody>
</table>
<p>A cobertura de saúde bucal para cada condição e faixa etária são apresentados abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lendo dados de cobertura para cada procedimento de saude bucal</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>cobertura_sb <span class="ot">&lt;-</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/cobertura sb.xlsx"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge, <span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># filtrando para Palmas-TO </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>cobertura_sb <span class="sc">|&gt;</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ibge <span class="sc">==</span> <span class="st">"172100"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ibge,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>id_faixa,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>li_cobertura, </span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>ls_cobertura) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 4
   municipio procedimento   faixa_etaria    cobertura
   &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;               &lt;dbl&gt;
 1 Palmas    Atenção Básica 0 a 14 anos         0.513
 2 Palmas    Endodontia     0 a 14 anos         0.025
 3 Palmas    Periodontia    0 a 14 anos         0    
 4 Palmas    Prótese        0 a 14 anos         0    
 5 Palmas    Atenção Básica 15 a 29 anos        0.568
 6 Palmas    Endodontia     15 a 29 anos        0.043
 7 Palmas    Periodontia    15 a 29 anos        0    
 8 Palmas    Prótese        15 a 29 anos        0.116
 9 Palmas    Atenção Básica 30 a 59 anos        0.836
10 Palmas    Endodontia     30 a 59 anos        0.072
11 Palmas    Periodontia    30 a 59 anos        0.056
12 Palmas    Prótese        30 a 59 anos        0.775
13 Palmas    Atenção Básica 60 anos ou mais     0.412
14 Palmas    Endodontia     60 anos ou mais     0.04 
15 Palmas    Periodontia    60 anos ou mais     0.024
16 Palmas    Prótese        60 anos ou mais     0.648</code></pre>
</div>
</div>
<p>Considerando os dados de população (P) e de cobertura (H), temos os seguintes resultados para população coberta.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># combinando por meio de left_join as tabelas de populacao (IBGE) e cobertura para cada tipo de servico (H)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>pop_coberta_palmas <span class="ot">&lt;-</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  pop_palmas <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cobertura_sb, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge"</span>,<span class="st">"id_faixa"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, municipio, </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         faixa, id_faixa, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         total, procedimento, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>         cobertura) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> cobertura <span class="sc">*</span> total) <span class="sc">|&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> <span class="fu">round</span>(populacao_coberta, <span class="dv">2</span>))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co"># visualizando </span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>pop_coberta_palmas <span class="sc">|&gt;</span> </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, faixa, </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>         total, procedimento, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>         cobertura, populacao_coberta) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 6
   municipio faixa             total procedimento   cobertura populacao_coberta
   &lt;chr&gt;     &lt;fct&gt;             &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;
 1 Palmas    de 0 a 14 anos    68457 Atenção Básica     0.513            35118.
 2 Palmas    de 0 a 14 anos    68457 Endodontia         0.025             1711.
 3 Palmas    de 0 a 14 anos    68457 Periodontia        0                    0 
 4 Palmas    de 0 a 14 anos    68457 Prótese            0                    0 
 5 Palmas    de 15 a 29 anos   82448 Atenção Básica     0.568            46830.
 6 Palmas    de 15 a 29 anos   82448 Endodontia         0.043             3545.
 7 Palmas    de 15 a 29 anos   82448 Periodontia        0                    0 
 8 Palmas    de 15 a 29 anos   82448 Prótese            0.116             9564.
 9 Palmas    de 30 a 59 anos  126871 Atenção Básica     0.836           106064.
10 Palmas    de 30 a 59 anos  126871 Endodontia         0.072             9135.
11 Palmas    de 30 a 59 anos  126871 Periodontia        0.056             7105.
12 Palmas    de 30 a 59 anos  126871 Prótese            0.775            98325.
13 Palmas    acima de 60 anos  24916 Atenção Básica     0.412            10265.
14 Palmas    acima de 60 anos  24916 Endodontia         0.04               997.
15 Palmas    acima de 60 anos  24916 Periodontia        0.024              598.
16 Palmas    acima de 60 anos  24916 Prótese            0.648            16146.</code></pre>
</div>
</div>
</section>
<section id="parâmetros-normativos-de-procedimentos-per-capita-s" class="level3">
<h3 class="anchored" data-anchor-id="parâmetros-normativos-de-procedimentos-per-capita-s">2.3. Parâmetros normativos de procedimentos per capita (S)</h3>
<p>Os cálculos de necessidade normativa por procedimento per capita (S) estão disponíveis nos parâmetros do Ministério da Saúde e são baseados na pesquisa de Saúde Bucal (SB 2010).</p>
<table class="caption-top table">
<caption>Fonte: Brasil (2021)</caption>
<colgroup>
<col style="width: 5%">
<col style="width: 94%">
</colgroup>
<thead>
<tr class="header">
<th>Área</th>
<th>Procedimentos</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Atenção básica</td>
<td><p>No banco de dados do projeto SB BRASIL 2010 foram transformados os códigos 0 (hígido), A (não examinado) e X (excluído) das variáveis CPI17, CPI11, CPI 27, CPI37, CPI31 e CPI47 em 0 e em 1 para as variáveis que tivessem o código 2 (cálculo) e 3 (bolsa rasa).</p>
<p>Ao final essas variáveis foram somadas e a variável NECPERIO_AB criada para armazenar esta soma.</p>
<p>Foram somados os valores referentes as variáveis NT_1, NT_2, NT_6, NT_7 e NT_8 formando a variável NEC_AB. Finalmente foram somadas NECPERIO_AB e NEC_AB para se obter a variável NEC_AB_TOTAL.</p>
<p>Foi então obtida a média da variável NEC_AB_TOTAL estratificada por idade e domínios geográficos (capitais e interior).</p></td>
</tr>
<tr class="even">
<td>Endodontia</td>
<td>Foi obtida a média da variável NT_5 (Número de dentes necessitando de tratamento pulpar + restauração) estratificada por idade e domínios geográficos (capitais e interior).</td>
</tr>
<tr class="odd">
<td>Periodontia</td>
<td><p>No banco de dados do projeto SB BRASIL 2010 foram transformados os códigos 0 (hígido), A (não examinado) e X (excluído) das variáveis CPI17, CPI11, CPI 27, CPI37, CPI31 e CPI47 em 0 e em 1 para as variáveis que tivessem o código 4 (bolsa profunda).</p>
<p>Ao final essas variáveis foram somadas e a variável NECPERIO_ESPEC criada para armazenar esta soma.</p>
<p>Foi então obtida a média da variável NECPERIO_ESPEC estratificada por idade e domínios geográficos (capitais e interior). Para as idades de 5 e 12 anos esta variável não foi mensurada no projeto SB BRASIL 2010, portanto não há dados de necessidade normativa para a faixa de 0 a 14 anos.</p></td>
</tr>
<tr class="even">
<td>Prótese</td>
<td><p>A variável NECPROT foi transformada em NUMPROT (número de próteses) como explicitado a seguir:</p>
<ul>
<li>Se NECPROT = 0 (Não necessita), então NUMPROT = 0</li>
<li>Se NECPROT = 1 (Parcial 1 maxilar), então NUMPROT = 1</li>
<li>Se NECPROT = 2 (Parcial 2 maxilares), então NUMPROT = 2</li>
<li>Se NECPROT = 3 (Total 1 maxilar), então NUMPROT = 3</li>
<li>Se NECPROT = 4 (Parcial + total), então NUMPROT = 2</li>
<li>Se NECPROT = 5 (Total 2 maxilares), então NUMPROT = 2</li>
<li>Se NECPROT = 9 (Sem informação), então NUMPROT = 0</li>
</ul>
<p>Foi então obtida a média da variável NUMPROT estratificada por idade e domínios geográficos (capitais e interior).</p>
<p>Para as idades de 5 e 12 anos esta variável não foi mensurada no projeto SB BRASIL 2010, portanto não há dados de necessidade normativa para a faixa de 0 a 14 anos.</p></td>
</tr>
</tbody>
</table>
<p>O código abaixo acessa dados de produção normativa em Palmas-TO, disponível nos parâmetros do Ministério da Saúde.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fazendo a leitura dos dados</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>producao_normativa <span class="ot">&lt;-</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/cobertura sb.xlsx"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"Produção normativa"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"text"</span>,<span class="st">"text"</span>, <span class="st">"text"</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"text"</span>, <span class="st">"numeric"</span>,<span class="st">"numeric"</span>, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"numeric"</span>, <span class="st">"numeric"</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge, <span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrando Palmas-TO</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>producao_palmas <span class="ot">&lt;-</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        producao_normativa <span class="sc">|&gt;</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(ibge <span class="sc">==</span> <span class="st">"172100"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="sc">-</span>municipio, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>li_cobertura,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>ls_cobertura,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>faixa_etaria)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntando a tabela de producao normativa (S) para calcular a NSB ao multiplicar a populacao coberta e producao per capita</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>necessidades_servicos <span class="ot">&lt;-</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                pop_coberta_palmas <span class="sc">|&gt;</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">left_join</span>(producao_palmas, </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge"</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"id_faixa"</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"procedimento"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                                  populacao_coberta <span class="sc">*</span> producao_pc) <span class="sc">|&gt;</span> </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">round</span>(nec_servicos, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="tradução-do-número-de-serviços-em-número-de-profissionais-necessários" class="level2">
<h2 class="anchored" data-anchor-id="tradução-do-número-de-serviços-em-número-de-profissionais-necessários">3. Tradução do número de serviços em número de profissionais necessários</h2>
<p>A etapa 3 consiste na tradução do número de serviços, calculado pela equação 1, em número de profissionais necessários (NPSB). Para isso, devem ser considerados dois elementos: produtividade (T) e o tempo total disponível (TTD).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/eq2_sb.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Onde:</p>
<ul>
<li>NPSB = Necessidade de profissionais de saúde bucal;</li>
<li>NSB = Necessidade de saúde bucal contabilizada pelo número de serviços do tipo t destinados ao atendimento de população de faixa etária i e localidade l;</li>
<li>T = Tempo médio de serviços do tipo t;</li>
<li>TTD = Tempo total disponível de um profissional ao longo de um ano.</li>
</ul>
<p>Vamos utilizar como tempo médio de consulta (T) o valor de 25 minutos. Esse valor foi baseado em um levantamento utilizando técnicas de time-motion realizado para aferir o tempo médio de procedimentos executados pela equipe de saúde bucal, em unidades básicas de saúde em São Paulo, Brasil (Bellotti et al, 2024).</p>
<p>O tempo total disponível (TTD) corresponde ao tempo de um profissional deduzidas ausências programáticas (ex.: férias, feriados) e não programáticos (ex.: licenças para tratamento de saúde). Vamos utilizar como referência o TTD estimado em 1576 horas, frequentemente usado para enfermeiros. Infelizmente, não temos estudos que já tenham levantado um TTD para profissionais de saúde bucal no Brasil.</p>
<p>Este resultado indica quantos cirurgiões dentistas por mês são necessários ao longo de um ano para cobrir as necessidades da população.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a necessidade de profissionais utilizando os parametros de tempo e de TTD</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>necessidades_prof_palmas <span class="ot">&lt;-</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                    necessidades_servicos <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">nec_prof =</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                   (nec_servicos <span class="sc">*</span> <span class="dv">25</span><span class="sc">/</span><span class="dv">60</span>)<span class="sc">/</span><span class="dv">1576</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">nivel =</span> <span class="fu">if_else</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                            procedimento <span class="sc">==</span> <span class="st">"Atenção Básica"</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"APS"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"AES"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">group_by</span>(ibge, municipio, nivel) <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">summarise</span>(<span class="at">necessidade =</span> <span class="fu">sum</span>(nec_prof)) <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>))</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>necessidades_prof_palmas <span class="sc">|&gt;</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ibge) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  municipio nivel necessidade
  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
1 Palmas    AES          34.4
2 Palmas    APS         159. </code></pre>
</div>
</div>
</section>
<section id="exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos" class="level2">
<h2 class="anchored" data-anchor-id="exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos">4. Exploração das implicações em termos de recursos, como a oferta atual de profissionais e custos</h2>
<p>O próximo passo consiste em algumas etapas, sendo elas:</p>
<ol type="1">
<li>Obtenção da oferta de profissionais;</li>
<li>Cálculo de valor líquido da oferta;</li>
<li>Comparação da oferta com necessidades;</li>
</ol>
<section id="obtenção-da-oferta-de-profissionais" class="level3">
<h3 class="anchored" data-anchor-id="obtenção-da-oferta-de-profissionais">4.1. Obtenção da oferta de profissionais</h3>
<p>A oferta de profissionais foi acessada usando o Cadastro Nacional de Estabelecimentos de Saúde - tabela Profissionais (CNES-PF).</p>
<p>Como profissionais podem ter múltiplos vínculos, padronizou-se a contagem por meio do Full-time equivalent (FTE), com base na carga horária de contrato.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># codigo para acessar dados de datalake proprio </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>dremio_host <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"endereco"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>dremio_port <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"port"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>dremio_uid <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"uid"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>dremio_pwd <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"datalake"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>channel <span class="ot">&lt;-</span> <span class="fu">odbcDriverConnect</span>(<span class="fu">sprintf</span>(<span class="st">"DRIVER=Dremio Connector;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="st">                                     HOST=%s;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="st">                                     PORT=%s;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="st">                                     UID=%s;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="st">                                     PWD=%s;</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="st">                                     AUTHENTICATIONTYPE=Basic Authentication;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="st">                                     CONNECTIONTYPE=Direct"</span>, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                         dremio_host, </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>                         dremio_port, </span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                         dremio_uid, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                         dremio_pwd))</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">'SELECT * FROM "Analytics Layer".Infraestrutura.Profissionais."TSB e dentistas por municipio"'</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>oferta <span class="ot">&lt;-</span> <span class="fu">sqlQuery</span>(channel, query, </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">as.is =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A consulta <code>SQL</code> que gerou esta tabela de dados está descrito abaixo.</p>
<p>Acessamos dados de todos os municípios para a <code>COMPETEN</code> (mês e ano) de janeiro de 2024. Foram acessados dados de Cirurgiões dentistas e Técnicos e Auxiliares de Saúde Bucal. Acessamos registros de profissionais atuantes no SUS e na saúde suplementar a partir da variável <code>PROF_SUS</code>. Para uma primeira análise vamos fazer simulações apenas para o recorte de profissionais SUS.</p>
<p>Foram acessados dados dos seguintes tipos de unidade (<code>TP_UNID</code>):</p>
<ul>
<li>Atenção Primária à Saúde (APS)
<ul>
<li>01 - Posto de saúde</li>
<li>02 - Centro de Saúde/Unidade Básica</li>
<li>32 - Unidade Móvel Fluvial</li>
<li>40 - Unidade Móvel Terrestre</li>
</ul></li>
<li>Atenção Especializada à Saúde (AES)
<ul>
<li>36 - Clínica/Centro de Especialidade</li>
<li>73 - Pronto atendimento</li>
<li>04 - Policlínica</li>
<li>22 - Consultório Isolado</li>
</ul></li>
</ul>
<p>Não foi incluída a força de trabalho atuante em hospitais, tendo em vista o escopo da metodologia.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">WITH</span> PROF <span class="kw">AS</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        CNES,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        CODUFMUN, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        COMPETEN, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        PROF_SUS, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">CASE</span>     </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">WHEN</span> TP_UNID <span class="op">=</span> <span class="st">'01'</span> <span class="kw">OR</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'02'</span> <span class="kw">OR</span> </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'32'</span> <span class="kw">OR</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'40'</span> <span class="cf">THEN</span>  <span class="st">'APS'</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">WHEN</span> TP_UNID <span class="op">=</span> <span class="st">'36'</span> <span class="kw">OR</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'73'</span> <span class="kw">OR</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'04'</span> <span class="kw">OR</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                        TP_UNID <span class="op">=</span> <span class="st">'22'</span> <span class="cf">THEN</span> <span class="st">'AES'</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">END</span> NIVEL,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">SUBSTR</span>(CBO, <span class="dv">1</span>, <span class="dv">4</span>) <span class="kw">AS</span> FAM_CBO,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">CASE</span> </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">WHEN</span> <span class="fu">substr</span>(CBO, <span class="dv">1</span>, <span class="dv">4</span>) <span class="op">=</span> <span class="st">'2232'</span> </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">THEN</span> <span class="st">'Cirurgião-dentista'</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">WHEN</span> <span class="fu">substr</span>(CBO, <span class="dv">1</span>, <span class="dv">4</span>) <span class="op">=</span> <span class="st">'3224'</span> </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">THEN</span> <span class="st">'Técnico ou Auxiliar de Saúde Bucal'</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">END</span> CATEGORIA,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>            (HORAOUTR <span class="op">+</span> HORAHOSP <span class="op">+</span> HORA_AMB) <span class="kw">AS</span> ch_total,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">CAST</span>((<span class="fu">CAST</span>(HORAOUTR <span class="op">+</span> HORAHOSP <span class="op">+</span> HORA_AMB <span class="kw">AS</span> <span class="dt">FLOAT</span>)<span class="op">/</span><span class="fu">CAST</span>(<span class="dv">40</span> <span class="kw">AS</span> <span class="dt">FLOAT</span>)) <span class="kw">AS</span> <span class="dt">FLOAT</span>) <span class="kw">AS</span> fte40</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> Dados.cnes.PF pf</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                    </span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> (<span class="fu">substr</span>(CBO, <span class="dv">1</span>, <span class="dv">4</span>) <span class="op">=</span> <span class="st">'2232'</span> <span class="kw">OR</span> </span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">substr</span>(CBO, <span class="dv">1</span>, <span class="dv">4</span>) <span class="op">=</span> <span class="st">'3224'</span>) <span class="kw">AND</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            COMPETEN <span class="op">=</span> <span class="st">'202401'</span> <span class="kw">AND</span> </span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            NIVEL <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> CODUFMUN, </span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>       PROF_SUS, </span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>       NIVEL, </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>       FAM_CBO, </span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>       CATEGORIA,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>       <span class="fu">SUM</span>(ch_total) <span class="kw">AS</span> CH,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>       <span class="fu">ROUND</span>(<span class="fu">SUM</span>(fte40),<span class="dv">2</span>) <span class="kw">AS</span> fte40 </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> PROF</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>       CODUFMUN, </span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>       PROF_SUS, </span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>       NIVEL, </span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>       FAM_CBO, </span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>       CATEGORIA</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vamos filtrar apenas para acessar dados de Palmas (TO) e profissionais atuando no SUS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filtro para Palmas-TO e profissionais atuando no SUS</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>oferta_palmas <span class="ot">&lt;-</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  oferta <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CODUFMUN <span class="sc">==</span> <span class="st">"172100"</span> <span class="sc">&amp;</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>         PROF_SUS <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CODUFMUN, CATEGORIA, NIVEL) <span class="sc">|&gt;</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">FTE40 =</span> <span class="fu">sum</span>(fte40)) <span class="sc">|&gt;</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NIVEL <span class="sc">!=</span> <span class="st">"NA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NIVEL =</span> <span class="fu">if_else</span>(NIVEL <span class="sc">==</span> <span class="st">"APS"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"APS"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"AES"</span>))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cálculo-de-valor-líquido-da-oferta" class="level3">
<h3 class="anchored" data-anchor-id="cálculo-de-valor-líquido-da-oferta">4.2. Cálculo de valor líquido da oferta</h3>
<p>O cálculo do valor líquido da oferta é feito por meio da fórmula 3:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/eq3_sb.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Onde:</p>
<ul>
<li>O = Oferta de profissionais em dada localidade l;</li>
<li>E = Total de profissionais atuantes em estabelecimentos de saúde em dada localidade l;</li>
<li>AD = Percentual da carga de trabalho dedicada a atividades diretas (%);</li>
<li>FC = Percentual da carga de trabalho dedicada a um foco clínico (%)</li>
</ul>
<p>Não temos números associados a AD e FC. Vamos utilizar os valores abaixo, no entanto, já pensando na simulação mais a frente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a oferta de profissionais apos deducao de carga de trabalho dedicada a atividades diretas e ao foco clinico. </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>oferta_palmas <span class="ot">&lt;-</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  oferta_palmas <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_direto =</span> FTE40 <span class="sc">*</span> <span class="fl">0.80</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> FTE_40_direto <span class="sc">*</span> <span class="fl">0.80</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>oferta_palmas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
# Groups:   CODUFMUN, CATEGORIA [2]
  CODUFMUN CATEGORIA                      NIVEL FTE40 FTE_40_direto FTE_40_linha
  &lt;chr&gt;    &lt;chr&gt;                          &lt;chr&gt; &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;
1 172100   Cirurgião-dentista             AES    36            28.8         23.0
2 172100   Cirurgião-dentista             APS    99.8          79.8         63.8
3 172100   Técnico ou Auxiliar de Saúde … AES    16.8          13.4         10.7
4 172100   Técnico ou Auxiliar de Saúde … APS    78.1          62.5         50.0</code></pre>
</div>
</div>
</section>
<section id="implicações-de-resultados-em-termos-quantitativos" class="level3">
<h3 class="anchored" data-anchor-id="implicações-de-resultados-em-termos-quantitativos">4.3. Implicações de resultados em termos quantitativos</h3>
<p>Por fim, são feitos os cálculos entre oferta e necessidade. São aplicadas duas métricas:</p>
<ul>
<li><p>Resultado Absoluto (RA), que é referente à diferença entre oferta e necessidade, conforme equação 4;</p></li>
<li><p>Resultado Relativo (RR), que se refere à diferença percentual entre oferta e necessidade, conforme equação 5.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/eq4_sb.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Onde:</p>
<ul>
<li>RA = Resultado absoluto;</li>
<li>O = Oferta de cirurgiões-dentistas em dada localidade l;</li>
<li>NPSB = Necessidade de cirurgiões-dentistas em dada localidade l;</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/eq5_sb.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Onde:</p>
<ul>
<li>RR = Resultado relativo;</li>
<li>O = Oferta de cirurgiões-dentistas em dada localidade l;</li>
<li>NPSB = Necessidade de cirurgiões-dentistas em dada localidade l;</li>
</ul>
<p>Os cálculos são realizados conforme os scripts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># acessando oferta apenas para cirurgioes dentistas</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>oferta_palmas_cd <span class="ot">&lt;-</span> oferta_palmas <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(CATEGORIA <span class="sc">==</span> <span class="st">"Cirurgião-dentista"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># juntando os resultados de necessidade e oferta a partir da variavel do municipio e nivel de atencao. Em sequencia, comparando necessidade e oferta</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>oferta_vs_demanda <span class="ot">&lt;-</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  necessidades_prof_palmas <span class="sc">|&gt;</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(oferta_palmas_cd, </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge"</span><span class="ot">=</span><span class="st">"CODUFMUN"</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"nivel"</span> <span class="ot">=</span> <span class="st">"NIVEL"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> FTE_40_linha <span class="sc">-</span> necessidade, </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> (FTE_40_linha<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># apresentando parte dos resultados</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>oferta_vs_demanda <span class="sc">|&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> <span class="fu">round</span>(FTE_40_linha, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>         nivel, necessidade, </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>         FTE_40_linha, rr, ra) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `ibge`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
# Groups:   ibge, municipio [1]
  ibge   municipio nivel necessidade FTE_40_linha    rr    ra
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 172100 Palmas    AES          34.4         23.0  66.9 -11.4
2 172100 Palmas    APS         159.          63.8  40.1 -95.5</code></pre>
</div>
</div>
</section>
<section id="implicações-de-resultados-em-termos-financeiros" class="level3">
<h3 class="anchored" data-anchor-id="implicações-de-resultados-em-termos-financeiros">4.4. Implicações de resultados em termos financeiros</h3>
<p>Ao final, sugere-se o cálculo do impacto financeiro desta lacuna. Isso pode ser feito multiplicando o RA ao salário médio de cirurgiões dentistas em Palmas-TO adicionado a um custo trabalhista.</p>
<p>De acordo com dados da Pesquisa Nacional de Amostragem por Domicílio contínua (PNADc) do Instituto Brasileiro de Geografia e Estatística (IBGE), o salário médio é na ordem de R$ 4000. Adicionado a um fator para adicionar o custo trabalhista (1.42), tem-se os resultados na tabela a seguir.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>custo_palmas <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  oferta_vs_demanda <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">custo_mensal =</span> ra <span class="sc">*</span> (<span class="sc">-</span><span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">4000</span> <span class="sc">*</span> <span class="fl">1.42</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, municipio, nivel, CATEGORIA,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         custo_mensal)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>custo_palmas </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
# Groups:   ibge, municipio [1]
  ibge   municipio nivel CATEGORIA          custo_mensal
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;                     &lt;dbl&gt;
1 172100 Palmas    AES   Cirurgião-dentista       64752 
2 172100 Palmas    APS   Cirurgião-dentista      542383.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="b-aplicação-para-brasil" class="level1">
<h1>B) Aplicação para Brasil</h1>
<p>A mesma metodologia utilizada para o munícipio de Palmas-TO foi escalada para cada município brasileiro. Abaixo detalhamos a análise estruturada em etapas.</p>
<section id="análise-das-necessidades-de-saúde-bucal-para-o-brasil" class="level2">
<h2 class="anchored" data-anchor-id="análise-das-necessidades-de-saúde-bucal-para-o-brasil">5. Análise das necessidades de saúde bucal para o Brasil</h2>
<p>A análise da necessidade de saúde bucal (NSB) foi construída a partir de três elementos: distribuição da população por faixa etária (P), prevalência de condições de saúde bucal (H) e procedimentos per capita (S).</p>
<section id="levantando-a-faixa-etária-p---brasil" class="level3">
<h3 class="anchored" data-anchor-id="levantando-a-faixa-etária-p---brasil">5.1. Levantando a faixa etária (P) - Brasil</h3>
<p>A distribuição por faixa etária (P) foi construída com base em dados do último censo (2022) e estão disponíveis na página do IBGE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lendo dados do censo </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>pop_brasil <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/populacao_municipio_censo_completa.xlsx"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tratando para ajustar cada faixa etaria</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>pop_brasil_tratado <span class="ot">&lt;-</span> pop_brasil <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">select</span>(cod_municipiodv, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                         ibge_sb, municipio, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                         de_0_a_14_anos,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                         de_15_a_29_anos, </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                         de_30_a_59_anos,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                         acima_de_60_anos) <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"faixa"</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> <span class="st">"total"</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">faixa =</span> <span class="fu">gsub</span>(<span class="st">"_"</span>,<span class="st">" "</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                                      faixa)) <span class="sc">|&gt;</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">as.character</span>(ibge_sb)) <span class="sc">|&gt;</span> </span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge_sb, <span class="dv">1</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_municipiodv =</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">as.character</span>(cod_municipiodv)) <span class="sc">|&gt;</span> </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_mun_loc =</span> cod_municipiodv) <span class="sc">|&gt;</span> </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_municipiodv =</span> </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">substr</span>(cod_municipiodv, <span class="dv">1</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">id_faixa =</span> </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">case_when</span>(faixa <span class="sc">==</span> <span class="st">"de 0 a 14 anos"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                                     faixa <span class="sc">==</span> <span class="st">"de 15 a 29 anos"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                                     faixa <span class="sc">==</span> <span class="st">"de 30 a 59 anos"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                                     faixa <span class="sc">==</span> <span class="st">"acima de 60 anos"</span> <span class="sc">~</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotando a informação de faixa etária. Nota-se que a faixa etária com maior frequência é de 30 a 59 anos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ordem <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"de 0 a 14 anos"</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"de 15 a 29 anos"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"de 30 a 59 anos"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"acima de 60 anos"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>pop_brasil_tratado<span class="sc">$</span>faixa <span class="ot">&lt;-</span> <span class="fu">factor</span>(pop_brasil_tratado<span class="sc">$</span>faixa, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">levels =</span> ordem)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>pop_brasil_tratado <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> faixa, </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> total)) <span class="sc">+</span> </span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)) <span class="sc">+</span> </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Distribuição de faixa etária por município"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prevalência-de-condições-de-saúde-bucal-h---brasil" class="level3">
<h3 class="anchored" data-anchor-id="prevalência-de-condições-de-saúde-bucal-h---brasil">5.2. Prevalência de condições de saúde bucal (H) - Brasil</h3>
<p>Vamos fazer a leitura dos dados de cobertura de procedimentos para cada faixa etária em todos os municípios do Brasil para, em sequência, calcular a prevalência de condições de saúde bucal (H).</p>
<p>Conforme pode ser observado na tabela, as capitais de todos os estados possuem valores de cobertura associados. No entanto, municípios do interior não possuem uma cobertura individualizada, mas sim um parâmetro correspondente ao interior da região (ex.: o município de Formosa-GO fica no interior da Região Centro-Oeste, logo usamos o parâmetro de interior da Região Centro-Oeste).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lendo dados </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>cobertura_sb <span class="ot">&lt;-</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/cobertura sb.xlsx"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sheet =</span> <span class="st">"Cobertura"</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge, <span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># apresentando dados</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>cobertura_sb <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ibge,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>id_faixa,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>li_cobertura, </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>ls_cobertura) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 512 × 4
   municipio   procedimento   faixa_etaria cobertura
   &lt;chr&gt;       &lt;chr&gt;          &lt;chr&gt;            &lt;dbl&gt;
 1 Porto Velho Atenção Básica 0 a 14 anos      0.69 
 2 Porto Velho Endodontia     0 a 14 anos      0.074
 3 Porto Velho Periodontia    0 a 14 anos      0    
 4 Porto Velho Prótese        0 a 14 anos      0    
 5 Rio Branco  Atenção Básica 0 a 14 anos      0.625
 6 Rio Branco  Endodontia     0 a 14 anos      0.071
 7 Rio Branco  Periodontia    0 a 14 anos      0    
 8 Rio Branco  Prótese        0 a 14 anos      0    
 9 Manaus      Atenção Básica 0 a 14 anos      0.661
10 Manaus      Endodontia     0 a 14 anos      0.138
# ℹ 502 more rows</code></pre>
</div>
</div>
<p>No script abaixo, juntamos a população de cada município à respectiva cobertura.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tratando os dados devido ao padrao de codigo IBGE de 7 digitos em algumas bases</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>pop_brasil_tratado <span class="ot">&lt;-</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  pop_brasil_tratado <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ibge_sb =</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">as.character</span>(ibge_sb)) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ibge_sb =</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">str_sub</span>(ibge_sb, </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">start =</span> <span class="dv">1</span>, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">end =</span> <span class="dv">6</span>)) </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>cobertura_sb<span class="sc">$</span>ibge <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cobertura_sb<span class="sc">$</span>ibge)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># juntando base de populacao e cobertura de saude bucal</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>pop_coberta_br <span class="ot">&lt;-</span> </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  pop_brasil_tratado <span class="sc">|&gt;</span> </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cobertura_sb, </span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge_sb"</span> <span class="ot">=</span> <span class="st">"ibge"</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"id_faixa"</span> <span class="ot">=</span> <span class="st">"id_faixa"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, ibge_sb, </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>         municipio.x, </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>         faixa, id_faixa, </span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>         total, procedimento, cobertura, </span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>         cod_municipiodv, cod_mun_loc) <span class="sc">|&gt;</span> </span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">municipio =</span> municipio.x) <span class="sc">|&gt;</span> </span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> cobertura <span class="sc">*</span> total) <span class="sc">|&gt;</span> </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> <span class="fu">round</span>(populacao_coberta, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="parâmetros-normativos-de-procedimentos-per-capita-s---brasil" class="level3">
<h3 class="anchored" data-anchor-id="parâmetros-normativos-de-procedimentos-per-capita-s---brasil">5.3. Parâmetros normativos de procedimentos per capita (S) - BRASIL</h3>
<p>O próximo passo consiste em juntar as tabelas com o população coberta e a necessidade normativa para cada tipo de procedimento (S). Isso levará ao resultado da necessidade de saúde bucal (NSB), que corresponde ao total de serviços necessários para atender cada faixa etária.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># leitura do dado de producao normativa (S)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>producao_normativa_br <span class="ot">&lt;-</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_excel</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/cobertura sb.xlsx"</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"Produção normativa"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"text"</span>,<span class="st">"text"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"text"</span>,<span class="st">"text"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"numeric"</span>,<span class="st">"numeric"</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"numeric"</span>,<span class="st">"numeric"</span>)) <span class="sc">|&gt;</span>  </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge, <span class="dv">1</span>, <span class="dv">6</span>))</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>producao_brasil <span class="ot">&lt;-</span> producao_normativa_br <span class="sc">|&gt;</span> </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="sc">-</span>municipio, </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>li_cobertura,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>ls_cobertura,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>faixa_etaria)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># juntando populacao coberta e producao normativa para calcular o total de servicos necessarios</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>necessidades_servicos_br <span class="ot">&lt;-</span> pop_coberta_br <span class="sc">|&gt;</span> </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">left_join</span>(producao_brasil, </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge"</span> <span class="ot">=</span> <span class="st">"ibge"</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"id_faixa"</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">"procedimento"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>                                    populacao_coberta <span class="sc">*</span> producao_pc) <span class="sc">|&gt;</span> </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">round</span>(nec_servicos, <span class="dv">2</span>))</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>necessidades_servicos_br <span class="sc">|&gt;</span> </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, </span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>         procedimento, </span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>         faixa, </span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>         nec_servicos) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92,304 × 4
   municipio       procedimento   faixa          nec_servicos
   &lt;chr&gt;           &lt;chr&gt;          &lt;fct&gt;                 &lt;dbl&gt;
 1 Brasília        Atenção Básica de 0 a 14 anos     287239. 
 2 Brasília        Endodontia     de 0 a 14 anos        996. 
 3 Brasília        Periodontia    de 0 a 14 anos          0  
 4 Brasília        Prótese        de 0 a 14 anos          0  
 5 Goiânia         Atenção Básica de 0 a 14 anos    1283387. 
 6 Goiânia         Endodontia     de 0 a 14 anos        852. 
 7 Goiânia         Periodontia    de 0 a 14 anos          0  
 8 Goiânia         Prótese        de 0 a 14 anos          0  
 9 Abadia de Goiás Atenção Básica de 0 a 14 anos       9455. 
10 Abadia de Goiás Endodontia     de 0 a 14 anos         93.4
# ℹ 92,294 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="tradução-do-número-de-serviços-em-número-de-profissionais-necessários---brasil" class="level2">
<h2 class="anchored" data-anchor-id="tradução-do-número-de-serviços-em-número-de-profissionais-necessários---brasil">6. Tradução do número de serviços em número de profissionais necessários - BRASIL</h2>
<p>Uma vez que sabemos a necessidade de saúde bucal (NSB) com base na distribuição da população por faixa etária (P), prevalência de condições de saúde bucal (H) e procedimentos per capita (S) podemos traduzir o número de serviços em profissionais necessários.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculando a necessidade de profissionais com base no total no tempo medio de procedimentos e TTD</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>necessidades_prof_br <span class="ot">&lt;-</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>            necessidades_servicos_br <span class="sc">|&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">nec_prof =</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>                                (nec_servicos <span class="sc">*</span> <span class="dv">25</span><span class="sc">/</span><span class="dv">60</span>)<span class="sc">/</span><span class="dv">1576</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">nivel =</span> <span class="fu">if_else</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                            procedimento <span class="sc">==</span> <span class="st">"Atenção Básica"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"APS"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"AES"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">group_by</span>(ibge, municipio, </span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                                   nivel, cod_municipiodv, </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>                                   cod_mun_loc) <span class="sc">|&gt;</span> </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">summarise</span>(<span class="at">necessidade =</span> <span class="fu">sum</span>(nec_prof)) <span class="sc">|&gt;</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ibge', 'municipio', 'nivel',
'cod_municipiodv'. You can override using the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>necessidades_prof_br <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(municipio, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>         nivel, </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>         necessidade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,140 × 3
   municipio       nivel necessidade
   &lt;chr&gt;           &lt;chr&gt;       &lt;dbl&gt;
 1 Porto Velho     AES         57.6 
 2 Porto Velho     APS        431.  
 3 Rio Branco      AES         69.6 
 4 Rio Branco      APS        221.  
 5 Abaetetuba      AES         26.6 
 6 Abaetetuba      APS        160.  
 7 Abel Figueiredo AES          1.08
 8 Abel Figueiredo APS          5.98
 9 Abreulândia     AES          0.98
10 Abreulândia     APS          4.91
# ℹ 11,130 more rows</code></pre>
</div>
</div>
</section>
<section id="exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos-1" class="level2">
<h2 class="anchored" data-anchor-id="exploração-das-implicações-em-termos-de-recursos-como-a-oferta-atual-de-profissionais-e-custos-1">7. Exploração das implicações em termos de recursos, como a oferta atual de profissionais e custos</h2>
<p>O próximo passo consiste em algumas etapas, sendo elas:</p>
<ol type="1">
<li>Obtenção da oferta de profissionais;</li>
<li>Cálculo de valor líquido da oferta;</li>
<li>Comparação da oferta com necessidades;</li>
</ol>
<section id="obtenção-da-oferta-de-profissionais-1" class="level3">
<h3 class="anchored" data-anchor-id="obtenção-da-oferta-de-profissionais-1">7.1. Obtenção da oferta de profissionais</h3>
<p>O código abaixo traz o script de acesso a dados do CNES-PF para cirurgiões-dentistas e técnicos/auxiliares de saúde bucal, usando infraestrutura própria.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># codigo para acessar dados de um datalake </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>dremio_host <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"endereco"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>dremio_port <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"port"</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>dremio_uid <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"uid"</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>dremio_pwd <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"datalake"</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>channel <span class="ot">&lt;-</span> <span class="fu">odbcDriverConnect</span>(<span class="fu">sprintf</span>(<span class="st">"DRIVER=Dremio Connector;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="st">                                     HOST=%s;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="st">                                     PORT=%s;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="st">                                     UID=%s;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="st">                                     PWD=%s;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="st">                                     AUTHENTICATIONTYPE=Basic Authentication;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="st">                                     CONNECTIONTYPE=Direct"</span>, </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>                         dremio_host, </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                         dremio_port, </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                         dremio_uid, </span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                         dremio_pwd))</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>query <span class="ot">&lt;-</span> <span class="st">'SELECT * FROM "Analytics Layer".Infraestrutura.Profissionais."TSB e dentistas por municipio"'</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>oferta <span class="ot">&lt;-</span> <span class="fu">sqlQuery</span>(channel, query, </span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">as.is =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oferta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18322     7</code></pre>
</div>
</div>
<p>O script abaixo fazer alguns tratamentos em relação à oferta, pois nem todos os municípios terão profissionais em atenção especializada, por exemplo.</p>
<p>Temos que assegurar que tenhamos 44560 linhas na tabela (5570 municípios x dois níveis de atenção x duas categorias profissionais x dois tipos de vínculo, SUS e não SUS). Por isso é feito o tratamento abaixo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definindo o vetor com 5570 município</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>vetor <span class="ot">&lt;-</span> <span class="fu">unique</span>(necessidades_prof_br<span class="sc">$</span>cod_municipiodv)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Cada elemento do vetor será repetido 8 vezes (2 valores para 'nível', 2 valores para 'profissional' e 2 valores para 'SUS')</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>vetor_duplicado <span class="ot">&lt;-</span> <span class="fu">rep</span>(vetor, <span class="at">each =</span> <span class="dv">8</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando a coluna 'nível' com valores alternados entre 'APS' e 'AES'</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>nivel <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"APS"</span>, <span class="st">"AES"</span>), <span class="at">each =</span> <span class="dv">4</span>, <span class="at">length.out =</span> <span class="fu">length</span>(vetor_duplicado))</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando a coluna 'profissional' com valores alternados entre 'dentista' e 'TSB'</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>profissional <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"2232"</span>, <span class="st">"3224"</span>), <span class="at">each =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="fu">length</span>(vetor_duplicado))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando a coluna 'SUS' com valores alternados entre 0 e 1</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>SUS <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">'0'</span>, <span class="st">'1'</span>), <span class="at">length.out =</span> <span class="fu">length</span>(vetor_duplicado))</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o DataFrame</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">elemento =</span> vetor_duplicado, </span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">nivel =</span> nivel, </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">profissional =</span> profissional, </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">SUS =</span> SUS</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">ibge =</span> elemento)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>ibge <span class="ot">&lt;-</span> <span class="fu">as.character</span>(df<span class="sc">$</span>ibge)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>oferta_brasil <span class="ot">&lt;-</span> </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    df <span class="sc">|&gt;</span>  </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(oferta, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge"</span><span class="ot">=</span><span class="st">"CODUFMUN"</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"nivel"</span><span class="ot">=</span><span class="st">"NIVEL"</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"SUS"</span> <span class="ot">=</span> <span class="st">"PROF_SUS"</span>,</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"profissional"</span> <span class="ot">=</span> <span class="st">"FAM_CBO"</span>))</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>oferta_brasil<span class="sc">$</span>fte40[<span class="fu">is.na</span>(oferta_brasil<span class="sc">$</span>fte40)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>oferta_brasil<span class="sc">$</span>CH[<span class="fu">is.na</span>(oferta_brasil<span class="sc">$</span>CH)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oferta_brasil)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 44560     7</code></pre>
</div>
</div>
</section>
<section id="cálculo-de-valor-líquido-da-oferta-1" class="level3">
<h3 class="anchored" data-anchor-id="cálculo-de-valor-líquido-da-oferta-1">7.2. Cálculo de valor líquido da oferta</h3>
<p>O próximo passo consiste na deducação da força de trabalho associada a atividades indiretas, bem como o percentual associado à linha de cuidado. Os valores usados foram de 80%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>oferta_brasil <span class="ot">&lt;-</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  oferta_brasil <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_direto =</span> fte40 <span class="sc">*</span> <span class="fl">0.80</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> FTE_40_direto <span class="sc">*</span> <span class="fl">0.80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="implicações-de-resultados" class="level3">
<h3 class="anchored" data-anchor-id="implicações-de-resultados">7.3. Implicações de resultados</h3>
<p>Agora vamos comparar a força de trabalho disponível com a necessidade. Primeiro, apresentamos os resultados para cirurgiões-dentistas. Depois apresentamos para técnicos e auxiliares de saúde bucal.</p>
<section id="resultados-para-cirurgiões-dentistas" class="level4">
<h4 class="anchored" data-anchor-id="resultados-para-cirurgiões-dentistas">7.3.1. Resultados para cirurgiões-dentistas</h4>
<p>O script a seguir calcula os resultados para Cirurgiões dentistas <strong>por município</strong>. No momento vamos pegar apenas os profissionais atuantes no SUS.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>oferta_brasil_cd <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>          oferta_brasil <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(profissional <span class="sc">==</span> <span class="st">"2232"</span> <span class="sc">&amp;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                     SUS <span class="sc">==</span> <span class="st">"1"</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br <span class="ot">&lt;-</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  necessidades_prof_br <span class="sc">|&gt;</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(oferta_brasil_cd, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_municipiodv"</span><span class="ot">=</span><span class="st">"ibge"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"nivel"</span> <span class="ot">=</span> <span class="st">"nivel"</span>)) </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br<span class="sc">$</span>FTE_40_linha[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br<span class="sc">$</span>FTE_40_linha)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br<span class="sc">$</span>fte40[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br<span class="sc">$</span>fte40)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br<span class="sc">$</span>FTE_40_direto[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br<span class="sc">$</span>FTE_40_direto)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br <span class="ot">&lt;-</span> </span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_br <span class="sc">|&gt;</span> </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> FTE_40_linha <span class="sc">-</span> necessidade, </span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> (FTE_40_linha<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> <span class="fu">round</span>(FTE_40_linha, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, municipio, </span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>         nivel, necessidade, </span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>         FTE_40_linha, rr, ra, cod_municipiodv, </span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>         cod_mun_loc)</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br <span class="sc">|&gt;</span> </span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>cod_mun_loc,</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>           <span class="sc">-</span>cod_municipiodv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,140 × 8
# Groups:   ibge, municipio, nivel, cod_municipiodv [11,140]
   cod_municipiodv ibge   municipio nivel necessidade FTE_40_linha    rr      ra
   &lt;chr&gt;           &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1 110020          110020 Porto Ve… AES         57.6         30.4   52.8  -27.2 
 2 110020          110020 Porto Ve… APS        431.          62.9   14.6 -368.  
 3 120040          120040 Rio Bran… AES         69.6         31.5   45.2  -38.2 
 4 120040          120040 Rio Bran… APS        221.          39.2   17.8 -182.  
 5 150010          130000 Abaetetu… AES         26.6          3.68  13.8  -23.0 
 6 150010          130000 Abaetetu… APS        160.          21.8   13.6 -138.  
 7 150013          130000 Abel Fig… AES          1.08         0      0     -1.08
 8 150013          130000 Abel Fig… APS          5.98         1.28  21.4   -4.7 
 9 170025          130000 Abreulân… AES          0.98         0      0     -0.98
10 170025          130000 Abreulân… APS          4.91         1.6   32.6   -3.31
# ℹ 11,130 more rows</code></pre>
</div>
</div>
<p>Vamos gerar a visualização usando um mapa cloroplético. Alguns municípios não estão coloridos, pois o percentual excede 100%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mun <span class="ot">&lt;-</span> <span class="fu">read_municipality</span>(<span class="at">code_muni=</span><span class="st">"all"</span>, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year=</span><span class="dv">2022</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>mun <span class="ot">&lt;-</span> mun <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">code_muni =</span> </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.character</span>(code_muni))</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>mun2 <span class="ot">&lt;-</span> cd_oferta_vs_demanda_br <span class="sc">|&gt;</span> </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(mun, <span class="at">by=</span> <span class="fu">c</span>(<span class="st">"cod_mun_loc"</span> <span class="ot">=</span> <span class="st">"code_muni"</span>))</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>mun_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mun2)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>estados_br <span class="ot">&lt;-</span> <span class="fu">read_state</span>(<span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mun_sf, <span class="fu">aes</span>(<span class="at">fill =</span> rr), </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#D92B3A"</span>, </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"blue"</span>, </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"#371F78"</span>), </span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> <span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">100</span>)), </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span>  </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> estados_br, </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"#B8B8B8"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Taxa RR"</span>) <span class="sc">+</span>  </span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>nivel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>De acordo com os resultados das tabelas, nós temos alguns poucos municípios que possuem um resultado relativo muito elevado, na ordem de 400%. Isso significa que a oferta é muito superior à necessidade. Isso ocorre geralmente em municípios muito pequenos. O município de Cedro de Abaeté - MG possui apenas 1.081 habitantes. Com bases nos cálculos, a necessidade é de 0,49 profissionais para APS. No entanto, o município conta com 1,98 profissionais. Por isso a diferença elevada. No mapa acima, restringimos apenas até 100% de resultado r</p>
<p>Mas também podemos incluir outras formas de agregação da informação, a exemplo dos dados apresentados por <strong>região de saúde</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lendo a base de hierarquia de localidades para juntar os municipios as respectivas regioes de saude e assim agregar os dados por regiao de saude</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>hierarquia_municipios <span class="ot">&lt;-</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/hierarquia_atualizada.csv"</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>hierarquia <span class="ot">&lt;-</span> </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>          hierarquia_municipios <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(cod_municipiodv, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                 uf_sigla, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                 regiao,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                 cod_regsaud,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                 regiao_saude)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>hierarquia<span class="sc">$</span>cod_municipiodv <span class="ot">&lt;-</span> </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>(hierarquia<span class="sc">$</span>cod_municipiodv)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_regiao_saude <span class="ot">&lt;-</span> </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_br <span class="sc">|&gt;</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(hierarquia, </span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_mun_loc"</span><span class="ot">=</span><span class="st">"cod_municipiodv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(nivel, cod_regsaud, uf_sigla,</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>             regiao_saude) <span class="sc">|&gt;</span> </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">necessidade =</span> <span class="fu">sum</span>(necessidade),</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">oferta =</span> <span class="fu">sum</span>(FTE_40_linha)) <span class="sc">|&gt;</span> </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ra =</span> oferta <span class="sc">-</span> necessidade, </span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">rr =</span> (oferta<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Script para criar o mapa de regiões de saúde.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>estados_br <span class="ot">&lt;-</span> <span class="fu">read_state</span>(<span class="at">year =</span> <span class="dv">2020</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geojson_read</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/shape_file_regioes_saude.json"</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">what =</span> <span class="st">"sp"</span>) </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">&lt;-</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(spdf)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir limites de longitude e latitude para focar no Brasil</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>limite_long <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">75</span>, <span class="sc">-</span><span class="dv">28</span>)  <span class="co"># limites de longitude</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>limite_lat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">33</span>, <span class="dv">4</span>)     <span class="co"># limites de latitude</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar o mapa</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>mapa_rs <span class="ot">&lt;-</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_regiao_saude <span class="sc">|&gt;</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(spdf_fortified, </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_regsaud"</span><span class="ot">=</span><span class="st">"reg_id"</span>)) </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar geometria se não existir</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"geometry"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mapa_rs)) {</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>  mapa_rs <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mapa_rs, </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, </span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"latitude"</span>), </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mapa_rs, </span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> rr, <span class="at">geometry =</span> geometry), </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#e9e9e9"</span>) <span class="sc">+</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> estados_br, </span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#B8B8B8"</span>, </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#D92B3A"</span>, </span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"blue"</span>, </span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"#371F78"</span>), </span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> </span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">100</span>)), </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span>  </span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Taxa RR"</span>) <span class="sc">+</span>  </span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>nivel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resultados-para-tsbasb" class="level4">
<h4 class="anchored" data-anchor-id="resultados-para-tsbasb">7.3.2. Resultados para TSB/ASB</h4>
<p>Abaixo vamos calcular os percentuais absolutos e relativos para TSB e ASB assumindo uma necessidade de um profissional desta categoria para cada cirurgião dentista.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>oferta_brasil_tsb_asb <span class="ot">&lt;-</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>          oferta_brasil <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(profissional <span class="sc">==</span> <span class="st">"3224"</span> <span class="sc">&amp;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                     SUS <span class="sc">==</span> <span class="st">"1"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb <span class="ot">&lt;-</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  necessidades_prof_br <span class="sc">|&gt;</span> </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(oferta_brasil_tsb_asb, </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_municipiodv"</span><span class="ot">=</span><span class="st">"ibge"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"nivel"</span> <span class="ot">=</span> <span class="st">"nivel"</span>)) </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>FTE_40_linha[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>FTE_40_linha)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>fte40[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>fte40)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>FTE_40_direto[<span class="fu">is.na</span>(cd_oferta_vs_demanda_br_tsb_asb<span class="sc">$</span>FTE_40_direto)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb <span class="ot">&lt;-</span> </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_br_tsb_asb <span class="sc">|&gt;</span> </span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> FTE_40_linha <span class="sc">-</span> necessidade, </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> (FTE_40_linha<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> <span class="fu">round</span>(FTE_40_linha, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, municipio, </span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>         nivel, necessidade, </span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>         FTE_40_linha, rr, ra, cod_municipiodv, </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>         cod_mun_loc)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_br_tsb_asb <span class="sc">|&gt;</span> </span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ibge,</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>cod_municipiodv,</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>cod_mun_loc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,140 × 6
   municipio       nivel necessidade FTE_40_linha    rr      ra
   &lt;chr&gt;           &lt;chr&gt;       &lt;dbl&gt;        &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1 Porto Velho     AES         57.6         17.0   29.4  -40.6 
 2 Porto Velho     APS        431.          62.9   14.6 -368.  
 3 Rio Branco      AES         69.6         18.2   26.1  -51.5 
 4 Rio Branco      APS        221.          44.3   20.1 -176.  
 5 Abaetetuba      AES         26.6          1.76   6.6  -24.9 
 6 Abaetetuba      APS        160.          18.1   11.3 -142.  
 7 Abel Figueiredo AES          1.08         0      0     -1.08
 8 Abel Figueiredo APS          5.98         1.47  24.6   -4.51
 9 Abreulândia     AES          0.98         0      0     -0.98
10 Abreulândia     APS          4.91         1.28  26.1   -3.63
# ℹ 11,130 more rows</code></pre>
</div>
</div>
<p>Gerando o mapa cloroplético por município para TSB/ASB. Alguns municípios não estão coloridos, pois possuem percentuais superiores a 100% ou se o valor for igual 0%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>mun2_tsb_asb <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_br_tsb_asb <span class="sc">|&gt;</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mun, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span> <span class="fu">c</span>(<span class="st">"cod_mun_loc"</span> <span class="ot">=</span> <span class="st">"code_muni"</span>))</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>mun_sf_tsb_asb <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mun2_tsb_asb)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>estados_br <span class="ot">&lt;-</span> <span class="fu">read_state</span>(<span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">showProgress =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mun_sf_tsb_asb, </span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> rr), </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#D92B3A"</span>, </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"blue"</span>, </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"#371F78"</span>), </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> </span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">100</span>)), </span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span>  </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> estados_br, </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"#B8B8B8"</span>, <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Taxa RR"</span>) <span class="sc">+</span>  </span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>nivel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Também podemos incluir outras formas de agregação da informação, a exemplo dos dados apresentados por <strong>região de saúde</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>hierarquia_municipios <span class="ot">&lt;-</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/hierarquia_atualizada.csv"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>hierarquia <span class="ot">&lt;-</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>          hierarquia_municipios <span class="sc">|&gt;</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(cod_municipiodv, </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                 uf_sigla, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                 regiao,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>                 cod_regsaud,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>                 regiao_saude)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>hierarquia<span class="sc">$</span>cod_municipiodv <span class="ot">&lt;-</span> </span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>(hierarquia<span class="sc">$</span>cod_municipiodv)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>cd_oferta_vs_demanda_regiao_saude_tsb_asb <span class="ot">&lt;-</span> </span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_br_tsb_asb <span class="sc">|&gt;</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(hierarquia, </span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_mun_loc"</span><span class="ot">=</span><span class="st">"cod_municipiodv"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(nivel, cod_regsaud, uf_sigla,</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>             regiao_saude) <span class="sc">|&gt;</span> </span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">necessidade =</span> <span class="fu">sum</span>(necessidade),</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">oferta =</span> <span class="fu">sum</span>(FTE_40_linha)) <span class="sc">|&gt;</span> </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ra =</span> oferta <span class="sc">-</span> necessidade, </span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">rr =</span> (oferta<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Criando o mapa por região de saúde.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>spdf <span class="ot">&lt;-</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geojson_read</span>(<span class="st">"~/GitHub/saude_bucal/01_dados/shape_file_regioes_saude.json"</span>, <span class="at">what =</span> <span class="st">"sp"</span>) </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>spdf_fortified <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(spdf)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating map</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>mapa_rs_tsb_asb <span class="ot">&lt;-</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  cd_oferta_vs_demanda_regiao_saude_tsb_asb <span class="sc">|&gt;</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(spdf_fortified, </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_regsaud"</span><span class="ot">=</span><span class="st">"reg_id"</span>)) </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add geometry if it does not exist</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"geometry"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mapa_rs_tsb_asb)) {</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  mapa_rs_tsb_asb <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(mapa_rs_tsb_asb, </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>), </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">crs =</span> <span class="dv">4326</span>) </span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mapa_rs_tsb_asb, </span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">fill =</span> rr, <span class="at">geometry =</span> geometry), </span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#e9e9e9"</span>) <span class="sc">+</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> estados_br, </span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="cn">NA</span>, </span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">"#B8B8B8"</span>, </span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#D92B3A"</span>, </span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"blue"</span>, </span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"#371F78"</span>), </span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values =</span> </span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">rescale</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">100</span>)), </span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span>  </span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Taxa RR"</span>) <span class="sc">+</span>  </span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span> </span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>nivel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="br_script_sb_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As implicações financeiras serão feitas diretamente em um dashboard.</p>
</section>
</section>
</section>
<section id="análise-de-cenário" class="level2">
<h2 class="anchored" data-anchor-id="análise-de-cenário">8. Análise de Cenário</h2>
<p>Uma das últimas etapas do desenvolvimento de metodologias consiste na análise de cenário. Esta etapa é realizada, pois nem sempre temos parâmetros certos. Portanto, a análise é usada para simular a metodologia com diferentes parâmetros.</p>
<p>Criamos uma função para iterar sobre alguns valores. Isso permitirá visualizar o impacto da mudança neles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>gap_necessidade_oferta <span class="ot">&lt;-</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(tempo, ttd, pd, pl, sus, categoria){</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>          pop_brasil_tratado <span class="ot">&lt;-</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>                  pop_brasil <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">select</span>(cod_municipiodv, </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                         ibge_sb, municipio, de_0_a_14_anos,</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                         de_15_a_29_anos, de_30_a_59_anos,</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>                         acima_de_60_anos) <span class="sc">|&gt;</span> </span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"faixa"</span>, </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> <span class="st">"total"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">faixa =</span> <span class="fu">gsub</span>(<span class="st">"_"</span>,<span class="st">" "</span>,faixa)) <span class="sc">|&gt;</span> </span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">as.character</span>(ibge_sb)) <span class="sc">|&gt;</span> </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">ibge =</span> <span class="fu">substr</span>(ibge_sb, <span class="dv">1</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_municipiodv =</span> </span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">as.character</span>(cod_municipiodv)) <span class="sc">|&gt;</span> </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_mun_loc =</span> cod_municipiodv) <span class="sc">|&gt;</span> </span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">cod_municipiodv =</span> </span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">substr</span>(cod_municipiodv, <span class="dv">1</span>, <span class="dv">6</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">id_faixa =</span> <span class="fu">case_when</span>(</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 0 a 14 anos"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 15 a 29 anos"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"de 30 a 59 anos"</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>                    faixa <span class="sc">==</span> <span class="st">"acima de 60 anos"</span> <span class="sc">~</span> <span class="dv">4</span>))</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>pop_brasil_tratado <span class="ot">&lt;-</span></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>  pop_brasil_tratado <span class="sc">|&gt;</span> </span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ibge_sb =</span> <span class="fu">as.character</span>(ibge_sb)) <span class="sc">|&gt;</span> </span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ibge_sb =</span> <span class="fu">str_sub</span>(ibge_sb, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">6</span>))</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>cobertura_sb<span class="sc">$</span>ibge <span class="ot">&lt;-</span> <span class="fu">as.character</span>(cobertura_sb<span class="sc">$</span>ibge)</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>pop_coberta_br <span class="ot">&lt;-</span> </span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>  pop_brasil_tratado <span class="sc">|&gt;</span> </span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(cobertura_sb, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ibge_sb"</span> <span class="ot">=</span> <span class="st">"ibge"</span>,</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"id_faixa"</span> <span class="ot">=</span> <span class="st">"id_faixa"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, ibge_sb, municipio.x, </span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>         faixa, id_faixa, </span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>         total, procedimento, cobertura, </span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>         cod_municipiodv, cod_mun_loc) <span class="sc">|&gt;</span> </span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> cobertura <span class="sc">*</span> total) <span class="sc">|&gt;</span> </span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">populacao_coberta =</span> <span class="fu">round</span>(populacao_coberta, <span class="dv">2</span>))</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a>producao_brasil <span class="ot">&lt;-</span> producao_normativa_br <span class="sc">|&gt;</span> </span>
<span id="cb47-48"><a href="#cb47-48" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="sc">-</span>municipio, </span>
<span id="cb47-49"><a href="#cb47-49" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>li_cobertura,</span>
<span id="cb47-50"><a href="#cb47-50" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>ls_cobertura,</span>
<span id="cb47-51"><a href="#cb47-51" aria-hidden="true" tabindex="-1"></a>                             <span class="sc">-</span>faixa_etaria)</span>
<span id="cb47-52"><a href="#cb47-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-53"><a href="#cb47-53" aria-hidden="true" tabindex="-1"></a>necessidades_servicos_br <span class="ot">&lt;-</span> </span>
<span id="cb47-54"><a href="#cb47-54" aria-hidden="true" tabindex="-1"></a>                      pop_coberta_br <span class="sc">|&gt;</span> </span>
<span id="cb47-55"><a href="#cb47-55" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">left_join</span>(producao_brasil, </span>
<span id="cb47-56"><a href="#cb47-56" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> </span>
<span id="cb47-57"><a href="#cb47-57" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">c</span>(<span class="st">"ibge"</span> <span class="ot">=</span> <span class="st">"ibge"</span>,</span>
<span id="cb47-58"><a href="#cb47-58" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"id_faixa"</span>,<span class="st">"procedimento"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-59"><a href="#cb47-59" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb47-60"><a href="#cb47-60" aria-hidden="true" tabindex="-1"></a>                               populacao_coberta <span class="sc">*</span> producao_pc) <span class="sc">|&gt;</span> </span>
<span id="cb47-61"><a href="#cb47-61" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">nec_servicos =</span> </span>
<span id="cb47-62"><a href="#cb47-62" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">round</span>(nec_servicos, <span class="dv">2</span>))</span>
<span id="cb47-63"><a href="#cb47-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-64"><a href="#cb47-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-65"><a href="#cb47-65" aria-hidden="true" tabindex="-1"></a>necessidades_prof_br <span class="ot">&lt;-</span> </span>
<span id="cb47-66"><a href="#cb47-66" aria-hidden="true" tabindex="-1"></a>                  necessidades_servicos_br <span class="sc">|&gt;</span></span>
<span id="cb47-67"><a href="#cb47-67" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">nec_prof =</span> </span>
<span id="cb47-68"><a href="#cb47-68" aria-hidden="true" tabindex="-1"></a>                             (nec_servicos <span class="sc">*</span> tempo<span class="sc">/</span><span class="dv">60</span>)<span class="sc">/</span>ttd) <span class="sc">|&gt;</span> </span>
<span id="cb47-69"><a href="#cb47-69" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">nivel =</span> </span>
<span id="cb47-70"><a href="#cb47-70" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">if_else</span>(procedimento <span class="sc">==</span> <span class="st">"Atenção Básica"</span>,<span class="st">"APS"</span>,<span class="st">"AES"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-71"><a href="#cb47-71" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">group_by</span>(ibge, municipio.x, </span>
<span id="cb47-72"><a href="#cb47-72" aria-hidden="true" tabindex="-1"></a>                                   nivel, cod_municipiodv, cod_mun_loc) <span class="sc">|&gt;</span> </span>
<span id="cb47-73"><a href="#cb47-73" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">summarise</span>(<span class="at">necessidade =</span> </span>
<span id="cb47-74"><a href="#cb47-74" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">sum</span>(nec_prof))</span>
<span id="cb47-75"><a href="#cb47-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-76"><a href="#cb47-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-77"><a href="#cb47-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-78"><a href="#cb47-78" aria-hidden="true" tabindex="-1"></a>oferta<span class="sc">$</span>FTE40 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(oferta<span class="sc">$</span>FTE40)</span>
<span id="cb47-79"><a href="#cb47-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-80"><a href="#cb47-80" aria-hidden="true" tabindex="-1"></a>oferta_brasil <span class="ot">&lt;-</span> </span>
<span id="cb47-81"><a href="#cb47-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(todos <span class="sc">==</span> sus)</span>
<span id="cb47-82"><a href="#cb47-82" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb47-83"><a href="#cb47-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-84"><a href="#cb47-84" aria-hidden="true" tabindex="-1"></a>    oferta <span class="sc">|&gt;</span> </span>
<span id="cb47-85"><a href="#cb47-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(PROF_SUS <span class="sc">==</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-86"><a href="#cb47-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(CODUFMUN, CATEGORIA, NIVEL) <span class="sc">|&gt;</span> </span>
<span id="cb47-87"><a href="#cb47-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">FTE40 =</span> <span class="fu">sum</span>(FTE40)) <span class="sc">|&gt;</span> </span>
<span id="cb47-88"><a href="#cb47-88" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(NIVEL <span class="sc">!=</span> <span class="st">"NA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-89"><a href="#cb47-89" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">NIVEL =</span> <span class="fu">if_else</span>(NIVEL <span class="sc">==</span> <span class="st">"APS"</span>,<span class="st">"APS"</span>,<span class="st">"AES"</span>)) </span>
<span id="cb47-90"><a href="#cb47-90" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb47-91"><a href="#cb47-91" aria-hidden="true" tabindex="-1"></a>  oferta <span class="sc">|&gt;</span> </span>
<span id="cb47-92"><a href="#cb47-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CODUFMUN, CATEGORIA, NIVEL) <span class="sc">|&gt;</span> </span>
<span id="cb47-93"><a href="#cb47-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">FTE40 =</span> <span class="fu">sum</span>(FTE40)) <span class="sc">|&gt;</span> </span>
<span id="cb47-94"><a href="#cb47-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(NIVEL <span class="sc">!=</span> <span class="st">"NA"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-95"><a href="#cb47-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">NIVEL =</span> <span class="fu">if_else</span>(NIVEL <span class="sc">==</span> <span class="st">"APS"</span>,<span class="st">"APS"</span>,<span class="st">"AES"</span>)) </span>
<span id="cb47-96"><a href="#cb47-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-97"><a href="#cb47-97" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-98"><a href="#cb47-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-99"><a href="#cb47-99" aria-hidden="true" tabindex="-1"></a>oferta_brasil <span class="ot">&lt;-</span> </span>
<span id="cb47-100"><a href="#cb47-100" aria-hidden="true" tabindex="-1"></a>  oferta_brasil <span class="sc">|&gt;</span> </span>
<span id="cb47-101"><a href="#cb47-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_direto =</span> FTE40 <span class="sc">*</span> pd) <span class="sc">|&gt;</span> </span>
<span id="cb47-102"><a href="#cb47-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> FTE_40_direto <span class="sc">*</span> pl)</span>
<span id="cb47-103"><a href="#cb47-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-104"><a href="#cb47-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-105"><a href="#cb47-105" aria-hidden="true" tabindex="-1"></a>oferta_brasil_cd <span class="ot">&lt;-</span> oferta_brasil <span class="sc">|&gt;</span> </span>
<span id="cb47-106"><a href="#cb47-106" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(CATEGORIA <span class="sc">==</span> categoria)</span>
<span id="cb47-107"><a href="#cb47-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-108"><a href="#cb47-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Cirurgião-dentista</span></span>
<span id="cb47-109"><a href="#cb47-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-110"><a href="#cb47-110" aria-hidden="true" tabindex="-1"></a>oferta_vs_demanda <span class="ot">&lt;-</span></span>
<span id="cb47-111"><a href="#cb47-111" aria-hidden="true" tabindex="-1"></a>  necessidades_prof_br <span class="sc">|&gt;</span> </span>
<span id="cb47-112"><a href="#cb47-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(oferta_brasil_cd, </span>
<span id="cb47-113"><a href="#cb47-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_municipiodv"</span><span class="ot">=</span><span class="st">"CODUFMUN"</span>,</span>
<span id="cb47-114"><a href="#cb47-114" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"nivel"</span> <span class="ot">=</span> <span class="st">"NIVEL"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-115"><a href="#cb47-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> FTE_40_linha <span class="sc">-</span> necessidade, </span>
<span id="cb47-116"><a href="#cb47-116" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> (FTE_40_linha<span class="sc">/</span>necessidade) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-117"><a href="#cb47-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ra =</span> <span class="fu">round</span>(ra, <span class="dv">2</span>),</span>
<span id="cb47-118"><a href="#cb47-118" aria-hidden="true" tabindex="-1"></a>         <span class="at">rr =</span> <span class="fu">round</span>(rr, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-119"><a href="#cb47-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CATEGORIA <span class="sc">!=</span> <span class="st">"NA"</span>)</span>
<span id="cb47-120"><a href="#cb47-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-121"><a href="#cb47-121" aria-hidden="true" tabindex="-1"></a>oferta_vs_demanda <span class="ot">&lt;-</span> oferta_vs_demanda <span class="sc">|&gt;</span></span>
<span id="cb47-122"><a href="#cb47-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">necessidade =</span> <span class="fu">round</span>(necessidade, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-123"><a href="#cb47-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FTE_40_linha =</span> <span class="fu">round</span>(FTE_40_linha, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb47-124"><a href="#cb47-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ibge, municipio.x, </span>
<span id="cb47-125"><a href="#cb47-125" aria-hidden="true" tabindex="-1"></a>         nivel, necessidade, </span>
<span id="cb47-126"><a href="#cb47-126" aria-hidden="true" tabindex="-1"></a>         FTE_40_linha, rr, ra, cod_municipiodv, cod_mun_loc)</span>
<span id="cb47-127"><a href="#cb47-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-128"><a href="#cb47-128" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="executando-a-função-para-um-conjunto-de-valores" class="level4">
<h4 class="anchored" data-anchor-id="executando-a-função-para-um-conjunto-de-valores">8.1. Executando a função para um conjunto de valores</h4>
<p>Utilizamos uma lista de valores para iterar conforme a tabela abaixo. Estas combinações resultaram em 1600 combinações de resultados.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 30%">
<col style="width: 9%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th>Parâmetro</th>
<th>Sigla</th>
<th>Valores</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tempo total disponível</td>
<td>TTD</td>
<td>em horas: 1576; 1676; 1776; 1876</td>
</tr>
<tr class="even">
<td>Tempo de procedimentos</td>
<td>T</td>
<td>em minutos: 25, 35, 45, 55</td>
</tr>
<tr class="odd">
<td>Percentual de atividades diretas</td>
<td>PD</td>
<td>em unidade percentual: 50%, 60%, 80%, 90%, 100%</td>
</tr>
<tr class="even">
<td>Percentual de atividades da linha de cuidado</td>
<td>PL</td>
<td>em unidade percentual: 50%, 60%, 80%, 90%, 100%</td>
</tr>
<tr class="odd">
<td>Categoria profissional</td>
<td>CAT</td>
<td>Cirurgião-dentista e Técnico/Auxiliar de Saúde Bucal</td>
</tr>
<tr class="even">
<td>Recorte de Profissionais</td>
<td>SUS</td>
<td>TRUE (pegar todos profissionais, SUS e não SUS) ou FALSE (pegar só os profissionais SUS)</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando lista de vetores para cada parâmetro</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>list_ttd <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"1576"</span>,<span class="st">"1676"</span>, <span class="st">"1776"</span>, <span class="st">"1876"</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>list_tempo <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"25"</span>, <span class="st">"35"</span>, <span class="st">"45"</span>, <span class="st">"55"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>list_pd <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"0.50"</span>, <span class="st">"0.60"</span>, <span class="st">"0.80"</span>, <span class="st">"0.90"</span>, <span class="st">"1"</span>))</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>list_pl <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">c</span>(<span class="st">"0.50"</span>, <span class="st">"0.60"</span>, <span class="st">"0.80"</span>, <span class="st">"0.90"</span>, <span class="st">"1"</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>list_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Cirurgião-dentista"</span>,<span class="st">"Técnico ou Auxiliar de Saúde Bucal"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>list_sus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="co"># pegar todos os profissionais ou só SUS (false)</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Executando lista e guardando em uma lista </span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>resultado <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>iteracao <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>total_iteracoes <span class="ot">&lt;-</span> <span class="fu">length</span>(list_ttd) <span class="sc">*</span> <span class="fu">length</span>(list_tempo) <span class="sc">*</span> <span class="fu">length</span>(list_pd) <span class="sc">*</span> <span class="fu">length</span>(list_pl) <span class="sc">*</span> <span class="fu">length</span>(list_cat) <span class="sc">*</span> <span class="fu">length</span>(list_sus)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ttd <span class="cf">in</span> list_ttd) {</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (tempo <span class="cf">in</span> list_tempo) {</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (pd <span class="cf">in</span> list_pd) {</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (pl <span class="cf">in</span> list_pl) { </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(sus <span class="cf">in</span> list_sus){</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(cat <span class="cf">in</span> list_cat){</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>            iteracao <span class="ot">&lt;-</span> iteracao <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span>(<span class="st">"Iteração:"</span>, iteracao, <span class="st">"de"</span>, total_iteracoes, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>            res <span class="ot">&lt;-</span> </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">gap_necessidade_oferta</span>(</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tempo =</span> tempo, </span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ttd =</span> ttd, </span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pd =</span> pd, </span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pl =</span> pl,</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sus =</span> sus, </span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">cat =</span> cat)</span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>            res <span class="ot">&lt;-</span> <span class="fu">cbind</span>(res, </span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ttd =</span> ttd, </span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tempo =</span> tempo, </span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pd =</span> pd, </span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pl =</span> pl,</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sus =</span> sus,</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cat =</span> cat)</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>            res<span class="sc">$</span>atributos <span class="ot">&lt;-</span> <span class="fu">paste</span>(ttd, </span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a>                                   tempo, </span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a>                                   pd, </span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a>                                   pl, </span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>                                   sus,</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a>                                   cat, </span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a>            resultado[[<span class="fu">length</span>(resultado) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> res</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificando o tamanho da lista resultado</span></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(resultado)</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>resultado_teste <span class="ot">&lt;-</span> </span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>                <span class="fu">do.call</span>(rbind, resultado) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Depois de fazer as 1600 iterações, agregamos as colunas que identificam a região de saúde e salvamos o resultado em um dataframe, chamado <code>resultado_final</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>hierarquia_municipios<span class="sc">$</span>cod_municipio <span class="ot">&lt;-</span> <span class="fu">as.character</span>(hierarquia_municipios<span class="sc">$</span>cod_municipio)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>resultado_final <span class="ot">&lt;-</span> </span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                resultado_teste <span class="sc">|&gt;</span> </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">left_join</span>(hierarquia_municipios, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cod_municipiodv"</span><span class="ot">=</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"cod_municipio"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(cod_municipiodv, </span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>                        regiao, cod_uf, uf_sigla,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                        cod_regsaud, regiao_saude,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>                        municipio, latitude,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>                        longitude, nivel, </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                        necessidade, ttd,</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>                        tempo, pd, pl, cat, sus,  atributos,</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>                        FTE_40_linha, rr, ra)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv2</span>(resultado_final, <span class="st">"resultado_final_1600.csv"</span>)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>arrow<span class="sc">::</span><span class="fu">write_parquet</span>(resultado_final, <span class="st">"resultado_final_1600.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="referências" class="level1">
<h1>Referências</h1>
<p>Asamani, J. A., Christmals, C. D., &amp; Reitsma, G. M. (2021). The needs-based health workforce planning method: a systematic scoping review of analytical applications.&nbsp;<em>Health Policy and Planning</em>,&nbsp;<em>36</em>(8), 1325-1343.</p>
<p>Belotti, L., Maito, S., Vesga-Varela, A. L., de Almeida, L. Y., da Silva, M. T., Haddad, A. E., … &amp; Bonfim, D. (2024). Activities of the oral health teams in primary health care: a time-motion study.&nbsp;<em>BMC Health Services Research</em>,&nbsp;<em>24</em>(1), 617.</p>
<p>Brasil (2017). Portaria de Consolidação nº 1, 28 de setembro de 2017.&nbsp;<em>Consolidação das normas sobre os direitos e deveres dos usuários da saúde, a organização e o funcionamento do Sistema Único de Saúde. Diário Oficial da União</em>.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>